# DiffScope Configuration Example
# Rename this file to .diffscope.yml to use

# Model configuration
model: gpt-4o
temperature: 0.2
max_tokens: 4000
max_context_chars: 20000  # 0 disables context truncation
max_diff_chars: 40000     # 0 disables diff truncation
min_confidence: 0.0       # Drop comments below this confidence (0.0-1.0)
review_profile: balanced  # balanced | chill | assertive
review_instructions: |
  Prioritize security and correctness issues. Avoid stylistic comments unless they impact maintainability.
smart_review_summary: true   # Include AI-generated PR summary in smart-review output
smart_review_diagram: false  # Include Mermaid diagram in PR summary (smart-review)
symbol_index: true           # Build repo symbol index for cross-file context
symbol_index_max_files: 500
symbol_index_max_bytes: 200000
symbol_index_max_locations: 5
feedback_path: ".diffscope.feedback.json"

# API configuration (optional - can use environment variables)
# api_key: your-api-key-here
# base_url: https://api.openai.com/v1
# openai_use_responses: true  # Use OpenAI Responses API instead of chat completions

# Global exclude patterns
exclude_patterns:
  - "**/*.generated.*"
  - "**/node_modules/**"
  - "**/target/**"
  - "**/.git/**"
  - "**/dist/**"
  - "**/build/**"

# Path-specific configurations
paths:
  # API endpoints need extra security focus
  "src/api/**":
    focus:
      - security
      - validation
      - authentication
    review_instructions: |
      Treat auth and input validation as critical. Flag missing rate limits and unsafe defaults.
    severity_overrides:
      security: error  # Elevate all security issues to errors
    system_prompt: |
      Pay special attention to:
      - SQL injection vulnerabilities
      - Authentication bypass risks
      - Input validation gaps
      - Rate limiting implementation

  # Test files have different requirements
  "tests/**":
    focus:
      - coverage
      - assertions
      - test_quality
    severity_overrides:
      style: suggestion  # Downgrade style issues in tests
    ignore_patterns:
      - "*.snapshot"
      - "*.fixture"

  # Frontend components
  "src/components/**":
    focus:
      - accessibility
      - performance
      - react_best_practices
    extra_context:
      - "src/styles/theme.ts"  # Always include theme context

  # Database migrations are critical
  "migrations/**":
    focus:
      - data_integrity
      - rollback_safety
      - performance
    severity_overrides:
      bug: error  # All bugs in migrations are critical
    system_prompt: |
      Database migrations are critical. Check for:
      - Data loss risks
      - Rollback capability
      - Index performance impact
      - Lock duration concerns

  # Documentation files
  "docs/**":
    focus:
      - clarity
      - completeness
      - examples
    severity_overrides:
      bug: info  # Bugs in docs are less critical

# Plugin configuration
plugins:
  eslint: true
  semgrep: true
  duplicate_filter: true
